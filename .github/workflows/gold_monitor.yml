name: Gold Price Monitor

on:
  # å®šæ—¶è§¦å‘ï¼šæ¯å°æ—¶çš„ç¬¬5åˆ†é’Ÿè¿è¡Œï¼ˆä¾‹å¦‚ 1:05, 2:05...ï¼‰
  schedule:
    - cron: '5 */1 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆåœ¨GitHubé¡µé¢ä¸Šæ‰‹åŠ¨è¿è¡Œï¼‰
  workflow_dispatch:
  
  # å½“ä»£ç æœ‰pushæ—¶ä¹Ÿè¿è¡Œï¼ˆæµ‹è¯•ç”¨ï¼‰
  push:
    branches: [ main ]

jobs:
  monitor:
    runs-on: ubuntu-latest  # ä½¿ç”¨æœ€æ–°çš„Ubuntuç³»ç»Ÿ
    
    steps:
    # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç ï¼ˆæŠŠä»“åº“ä»£ç ä¸‹è½½åˆ°è™šæ‹Ÿæœºï¼‰
    - name: Checkout code
      uses: actions/checkout@v3
      
    # æ­¥éª¤2ï¼šè®¾ç½®Pythonç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'  # ä½¿ç”¨Python 3.9
        
    # æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
        
    # æ­¥éª¤4ï¼šè¿è¡Œé‡‘ä»·ç›‘æ§è„šæœ¬
    - name: Get gold price
      env:
        # ä»GitHub Secretsè¯»å–é…ç½®
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        GOLDAPI_TOKEN: ${{ secrets.GOLDAPI_TOKEN }}
      run: |
        echo "ğŸŸ¡ å¼€å§‹è·å–é‡‘ä»·..."
        python gold_price.py
        echo "âœ… ä»»åŠ¡å®Œæˆ"
        
    # æ­¥éª¤5ï¼šä¸Šä¼ å†å²è®°å½•æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
    - name: Upload history file
      uses: actions/upload-artifact@v3
      with:
        name: gold-history
        path: gold_history.json
